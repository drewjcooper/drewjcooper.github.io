---
layout: post
title: 'Exercise 5 – Reynolds again: overflow without exception'
date: '2010-07-13T22:53:00.001+10:00'
tags:
- C# Specifics
- C# Exercise
- ".NET Specifics"
modified_time: '2010-07-13T22:53:46.940+10:00'
---

<p>The 5th of Prashant’s <a href="http://www.jobsnake.com/seek/articles/index.cgi?openarticle&amp;8533" target="_blank">15 Exercises for Learning a new Programming Language</a> builds directly onto the <a href="http://learningcsharpnet.blogspot.com/2010/07/exercise-4-reynolds-number-basic-class.html" target="_blank">4th</a>:</p>  <blockquote>   <p>Modify the above program such that it will ask for 'Do you want to calculate again (y/n),      <br />if you say 'y', it'll again ask the parameters. If 'n', it'll exit. (Do while loop)</p>    <p>While running the program give value mu = 0. See what happens. Does it give 'DIVIDE BY ZERO' error?      <br />Does it give 'Segmentation fault..core dump?'. How to handle this situation. Is there something built       <br />in the language itself? (Exception Handling) </p> </blockquote>  <p>The first bit is easy, the second bit may be surprising.&#160; First thing I’ll do is show you what happens when I run the program from last time with mu = 0.</p> <a name='more'></a>  <pre class="console"><p>Calculate Reynold's Number and flow characteristic
Enter the Density (?):  15
Enter the Diameter (D):  15
Enter the Velocity (v):  15
Enter the Viscosity (µ):  0
Reynold's Number = Infinity (Turbulent flow)</p></pre>

<p>Well, how about that?&#160; No “divide by zero” exception; no crash and burn; just an infinite result.&#160; In fact, floating point operations in C# never throw an exception – they return either a valid number, or one of two special values, <strong>Infinity</strong> and <strong>NaN</strong> (Not a Number).&#160; It’s even possible to enter these values and have them parse correctly as floating point values as shown in this next program run:</p>

<pre class="console">Calculate Reynold's Number and flow characteristic
Enter the Density (?):  Infinity
Enter the Diameter (D):  4
Enter the Velocity (v):  5
Enter the Viscosity (µ):  Infinity
Reynold's Number = NaN (Turbulent flow)</console></pre>

<p>As shown above, a divide by zero results in the value <strong>Infinity</strong>, and a divide by Infinity results in NaN.&#160; In general, any overflow will result in the value <strong>Infinity</strong> as shown below:</p>

<pre class="console">Calculate Reynold's Number and flow characteristic
Enter the Density (?):  1E200
Enter the Diameter (D):  1E200
Enter the Velocity (v):  1E200
Enter the Viscosity (µ):  1
Reynold's Number = Infinity (Turbulent flow)</console></pre>

<p>The true result should be 1E+600, but that is too large to be represented by a double, so we get <strong>Infinity</strong> instead.</p>

<p>Even though we don’t have an exception or crash, it’s still not nice that we get an infinite result but still have a valid flow type returned.&#160; Also, there are a number of quantities in the Reynolds formula for which only a positive non-zero number make sense, one of which is the problematic Viscosity, so it would be good to filter the input of these values to something vaguely reasonable.</p>

<p>So with those thoughts, and the first part of the exercise in mind I present the code for this post:</p>

<div class="csharpcode">
  <pre><span class="lnum">   1:  </span><span class="kwrd">using</span> System;</pre>

  <pre><span class="lnum">   2:  </span>&#160;</pre>

  <pre><span class="lnum">   3:  </span><span class="kwrd">class</span> MainClass</pre>

  <pre><span class="lnum">   4:  </span>{</pre>

  <pre><span class="lnum">   5:  </span>    <span class="kwrd">static</span> <span class="kwrd">double</span> ReadNonNegativeDouble(<span class="kwrd">string</span> inputPrompt = <span class="str">&quot;Enter a number&quot;</span>, <span class="kwrd">bool</span> zeroAllowed = <span class="kwrd">false</span>)</pre>

  <pre><span class="lnum">   6:  </span>    {</pre>

  <pre><span class="lnum">   7:  </span>        <span class="kwrd">double</span> inputValue;</pre>

  <pre><span class="lnum">   8:  </span>&#160;</pre>

  <pre><span class="lnum">   9:  </span>        <span class="kwrd">do</span></pre>

  <pre><span class="lnum">  10:  </span>        {</pre>

  <pre><span class="lnum">  11:  </span>            Console.Write(inputPrompt + <span class="str">&quot;:  &quot;</span>);</pre>

  <pre><span class="lnum">  12:  </span>            <span class="kwrd">if</span> (<span class="kwrd">double</span>.TryParse(Console.ReadLine(), <span class="kwrd">out</span> inputValue))</pre>

  <pre><span class="lnum">  13:  </span>            {</pre>

  <pre><span class="lnum">  14:  </span>                <span class="kwrd">if</span> (inputValue &gt; 0 || inputValue == 0 &amp;&amp; zeroAllowed) <span class="kwrd">break</span>;</pre>

  <pre><span class="lnum">  15:  </span>            }</pre>

  <pre><span class="lnum">  16:  </span>        }</pre>

  <pre><span class="lnum">  17:  </span>        <span class="kwrd">while</span> (<span class="kwrd">true</span>);</pre>

  <pre><span class="lnum">  18:  </span>        <span class="kwrd">return</span> inputValue;</pre>

  <pre><span class="lnum">  19:  </span>    }</pre>

  <pre><span class="lnum">  20:  </span>&#160;</pre>

  <pre><span class="lnum">  21:  </span>    <span class="kwrd">static</span> <span class="kwrd">void</span> Main()</pre>

  <pre><span class="lnum">  22:  </span>    {</pre>

  <pre><span class="lnum">  23:  </span>        Reynolds reynolds = <span class="kwrd">new</span> Reynolds();</pre>

  <pre><span class="lnum">  24:  </span>        Console.WriteLine(<span class="str">&quot;\nCalculate Reynold's Number and flow characteristic\n&quot;</span>);</pre>

  <pre><span class="lnum">  25:  </span>        <span class="kwrd">do</span></pre>

  <pre><span class="lnum">  26:  </span>        {</pre>

  <pre><span class="lnum">  27:  </span>            reynolds.density = ReadNonNegativeDouble(<span class="str">&quot;Enter the Density (\x03c1)&quot;</span>);</pre>

  <pre><span class="lnum">  28:  </span>            reynolds.diameter = ReadNonNegativeDouble(<span class="str">&quot;Enter the Diameter (D)&quot;</span>);</pre>

  <pre><span class="lnum">  29:  </span>            reynolds.velocity = ReadNonNegativeDouble(<span class="str">&quot;Enter the Velocity (v)&quot;</span>, <span class="kwrd">true</span>);</pre>

  <pre><span class="lnum">  30:  </span>            reynolds.viscosity = ReadNonNegativeDouble(<span class="str">&quot;Enter the Viscosity (\x03bc)&quot;</span>);</pre>

  <pre><span class="lnum">  31:  </span>            <span class="kwrd">if</span> (<span class="kwrd">double</span>.IsInfinity(reynolds.Number)) </pre>

  <pre><span class="lnum">  32:  </span>            {</pre>

  <pre><span class="lnum">  33:  </span>                Console.WriteLine(<span class="str">&quot;Calculation overflow!&quot;</span>);</pre>

  <pre><span class="lnum">  34:  </span>            }</pre>

  <pre><span class="lnum">  35:  </span>            <span class="kwrd">else</span> <span class="kwrd">if</span> (<span class="kwrd">double</span>.IsNaN(reynolds.Number))</pre>

  <pre><span class="lnum">  36:  </span>            {</pre>

  <pre><span class="lnum">  37:  </span>                Console.WriteLine(<span class="str">&quot;Invalid result!&quot;</span>);</pre>

  <pre><span class="lnum">  38:  </span>            }</pre>

  <pre><span class="lnum">  39:  </span>            <span class="kwrd">else</span></pre>

  <pre><span class="lnum">  40:  </span>            {</pre>

  <pre><span class="lnum">  41:  </span>                Console.WriteLine(<span class="str">&quot;Reynold's Number = &quot;</span> + reynolds.Number.ToString() + <span class="str">&quot; (&quot;</span> + reynolds.FlowType + <span class="str">&quot; flow)&quot;</span>);</pre>

  <pre><span class="lnum">  42:  </span>            }</pre>

  <pre><span class="lnum">  43:  </span>            Console.Write(<span class="str">&quot;\nDo you want to calculate again? (y/n) &quot;</span>);</pre>

  <pre><span class="lnum">  44:  </span>            <span class="kwrd">while</span> (<span class="kwrd">true</span>) {</pre>

  <pre><span class="lnum">  45:  </span>                <span class="kwrd">char</span> keyPress = Console.ReadKey(<span class="kwrd">true</span>).KeyChar;</pre>

  <pre><span class="lnum">  46:  </span>                <span class="kwrd">if</span> (keyPress == <span class="str">'y'</span>) <span class="kwrd">break</span>;</pre>

  <pre><span class="lnum">  47:  </span>                <span class="kwrd">if</span> (keyPress == <span class="str">'n'</span>) <span class="kwrd">return</span>;</pre>

  <pre><span class="lnum">  48:  </span>            }</pre>

  <pre><span class="lnum">  49:  </span>            Console.Write(<span class="str">&quot;\n\n&quot;</span>);</pre>

  <pre><span class="lnum">  50:  </span>        } <span class="kwrd">while</span> (<span class="kwrd">true</span>);</pre>

  <pre><span class="lnum">  51:  </span>    }</pre>

  <pre><span class="lnum">  52:  </span>}</pre>

  <pre><span class="lnum">  53:  </span>&#160;</pre>

  <pre><span class="lnum">  54:  </span><span class="kwrd">class</span> Reynolds</pre>

  <pre><span class="lnum">  55:  </span>{</pre>

  <pre><span class="lnum">  56:  </span>    <span class="kwrd">public</span> <span class="kwrd">double</span> density;</pre>

  <pre><span class="lnum">  57:  </span>    <span class="kwrd">public</span> <span class="kwrd">double</span> diameter;</pre>

  <pre><span class="lnum">  58:  </span>    <span class="kwrd">public</span> <span class="kwrd">double</span> velocity;</pre>

  <pre><span class="lnum">  59:  </span>    <span class="kwrd">public</span> <span class="kwrd">double</span> viscosity;</pre>

  <pre><span class="lnum">  60:  </span>&#160;</pre>

  <pre><span class="lnum">  61:  </span>    <span class="kwrd">public</span> <span class="kwrd">double</span> Number</pre>

  <pre><span class="lnum">  62:  </span>    {</pre>

  <pre><span class="lnum">  63:  </span>        get</pre>

  <pre><span class="lnum">  64:  </span>        {</pre>

  <pre><span class="lnum">  65:  </span>            <span class="kwrd">return</span> density * diameter * velocity / viscosity;</pre>

  <pre><span class="lnum">  66:  </span>        }</pre>

  <pre><span class="lnum">  67:  </span>    }</pre>

  <pre><span class="lnum">  68:  </span>&#160;</pre>

  <pre><span class="lnum">  69:  </span>    <span class="kwrd">public</span> <span class="kwrd">string</span> FlowType</pre>

  <pre><span class="lnum">  70:  </span>    {</pre>

  <pre><span class="lnum">  71:  </span>        get</pre>

  <pre><span class="lnum">  72:  </span>        {</pre>

  <pre><span class="lnum">  73:  </span>            <span class="kwrd">if</span> (<span class="kwrd">double</span>.IsInfinity(Number) || <span class="kwrd">double</span>.IsNaN(Number)) </pre>

  <pre><span class="lnum">  74:  </span>            {</pre>

  <pre><span class="lnum">  75:  </span>                <span class="kwrd">return</span> <span class="str">&quot;Invalid result&quot;</span>;</pre>

  <pre><span class="lnum">  76:  </span>            }</pre>

  <pre><span class="lnum">  77:  </span>            <span class="kwrd">else</span> <span class="kwrd">if</span> (Number &lt; 2100)</pre>

  <pre><span class="lnum">  78:  </span>            {</pre>

  <pre><span class="lnum">  79:  </span>                <span class="kwrd">return</span> <span class="str">&quot;Laminar&quot;</span>;</pre>

  <pre><span class="lnum">  80:  </span>            }</pre>

  <pre><span class="lnum">  81:  </span>            <span class="kwrd">else</span> <span class="kwrd">if</span> (Number &lt; 4000)</pre>

  <pre><span class="lnum">  82:  </span>            {</pre>

  <pre><span class="lnum">  83:  </span>                <span class="kwrd">return</span> <span class="str">&quot;Transient&quot;</span>;</pre>

  <pre><span class="lnum">  84:  </span>            }</pre>

  <pre><span class="lnum">  85:  </span>            <span class="kwrd">else</span></pre>

  <pre><span class="lnum">  86:  </span>            {</pre>

  <pre><span class="lnum">  87:  </span>                <span class="kwrd">return</span> <span class="str">&quot;Turbulent&quot;</span>;</pre>

  <pre><span class="lnum">  88:  </span>            }</pre>

  <pre><span class="lnum">  89:  </span>        }</pre>

  <pre><span class="lnum">  90:  </span>    }</pre>

  <pre><span class="lnum">  91:  </span>}</pre>
</div>

<p>The only thing really worthy of note in this code is the use of two <strong>static methods</strong> of the <code>double</code> class, <code>double.IsInfinity()</code> and <code>double.IsNaN()</code>, which check a variable for these two special values.&#160; Here’s the result of these changes.</p>

<pre class="console">Calculate Reynold's Number and flow characteristic

Enter the Density (?):  15
Enter the Diameter (D):  15
Enter the Velocity (v):  15
Enter the Viscosity (µ):  3
Reynold's Number = 1125 (Laminar flow)

Do you want to calculate again? (y/n)

Enter the Density (?):  23
Enter the Diameter (D):  34
Enter the Velocity (v):  Infinity
Enter the Viscosity (µ):  Infinity
Invalid result!

Do you want to calculate again? (y/n)

Enter the Density (?):  32
Enter the Diameter (D):  23
Enter the Velocity (v):  43
Enter the Viscosity (µ):  0
Enter the Viscosity (µ):  4
Reynold's Number = 7912 (Turbulent flow)

Do you want to calculate again? (y/n)</console></pre>

<p>Next post will be the first of a small series which cover Exercise 6 of Prashant’s exercises.&#160; The solution I’ve developed has about 450 lines of code so it will take a few posts to get through it all.&#160; See you then.</p>  